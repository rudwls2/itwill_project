<!DOCTYPE html>
<!--[if IE 7]><html class="ie ie7 no-js" lang="en-US"><![endif]--><!--[if IE 8]><html class="ie ie8 no-js" lang="en-US"><![endif]--><!--[if !(IE 7) | !(IE 8)  ]><!-->
<html xmlns:th="http://www.thymeleaf.org">

<head><!-- Basic need -->
	<title>Mango>망고굿즈>detail</title>
	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="">
	<link rel="profile" href="#"><!--Google Font-->
	<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Dosis:400,700,500|Nunito:300,400,600' />
	<!-- Mobile specific meta -->
	<meta name=viewport content="width=device-width, initial-scale=1">
	<meta name="format-detection" content="telephone-no"><!-- CSS files -->
	<link rel="stylesheet" href="css/plugins.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/productTest.css">


	<style>
		.quantity-box {
			display: flex;
			align-items: center;
		}

		.quantity-input {
			text-align: center;
			margin: 0 5px;
			background-color: #fff;
			color: #333;
			padding: 8px 12px;
			font-weight: bold;
		}

		.quantity-button {
			cursor: pointer;
			background-color: #fff;
			color: #333;
			padding: 8px 12px;
			font-weight: bold;
		}
	</style>

</head>

<body>
	<div th:insert="~{common_header::headerFragment}"></div>


	<div class="ticketBackground" style="margin-top: 100px;">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
				</div>
			</div>
		</div>
	</div>

	<!--굿즈 정보전체[시작]-->
	<div class="page-single movie-single movie_single">
		<div class="container">
			<div class="row ipad-width2">
				<div class="col-md-4 col-sm-12 col-xs-12">
				<input id ="cartId" type = "hidden" th:value ="${cart.cartId}">
				<input id ="productNo" type = "hidden" th:value="${findGoods.productNo}">
				<input id ="userId" type = "hidden" th:value="${userIdString}">
					<div class="movie-img sticky-sb"><img th:src="${findGoods.productImage}"
							src="images/uploads/movie-single.jpg" alt="" style="max-width: 100%">
						<!--수량조절ui-->
						<!-- <div class="quantity-box" style="margin-top: 20px;" id ="qty"  >
							<div class="quantity-button" onclick="changeQuantity(-1)">-</div>
							<input class="quantity-input" type="text" value="1" id="qty" readonly>
							<div class="quantity-button" onclick="changeQuantity(1)">+</div>
						</div> -->

						<!--장바구니 담기 버튼-->
						<div class="movie-btn">
							<div class="btn-transform transform-vertical" id = "productNo">

								<div><a th:href="@{/cart_main}" class="item item-1 yellowbtn"onclick="sendPostRequest()">
								<!--<a th:href="@{/cart_main(productNo=${productNo})}" class="item item-1 yellowbtn"
										onclick="sendPostRequest()">-->
										<i class="ion-card"></i>장바구니 담기</a>
								</div>

	
								<div><a th:href="@{/cart_main}" class="item item-2 yellowbtn" onclick="sendPostRequest()">
							<div><a th:href="@{/cart_main(productNo=${productNo})}" class="item item-2 yellowbtn"
										onclick="sendPostRequest()">-->
										<i class="ion-card"></i>장바구니 담기</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				</div>
				<!--굿즈 정보표시[시작]-->
				<div class="col-md-8 col-sm-12 col-xs-12">
					<div class="movie-single-ct main-content">
						<h1 class="bd-hd" th:text="${findGoods.productName}">							
						</h1>
						<p> <span th:text="'가    격 : '+ ${findGoods.productPrice} + '원'"
								style="margin-bottom: 15px; margin-right: 60%; font-size: 30px; color: orange;"></span>
						</p>
							<!-- content 추가-->
					</div>
				<!--티켓 좋아요[시작]-->
					<div class="movie-rate">
						<div class="rate" style="margin-bottom: 30px;">							
						</div>
					</div>
				<!--티켓 좋아요[마지막]-->
					<!--탭 전체[시작]-->
					<div class="movie-tabs">
						<!--탭 [시작]-->
						<div class="tabs">
							<ul class="tab-links tabs-mv">
								<li class="active"><a href="#overview">상세설명</a></li>
								<li><a href="#reviews">댓글쓰기</a></li>
							</ul>

							<!--탭 내용 [시작]-->
							<div class="tab-content">
								<!--상세설명 [시작]-->
								<div id="overview" class="tab active">
									<h3 th:text = "|아티스트 : ${findGoods.productArtist}|" style="color: orange; font-size: 30px; margin-top:15px; margin-bottom: 15px;"></h3>

									<div class="row">
										<div class="col-md-8 col-sm-12 col-xs-12">
											<!--<p><span th:text="${findGoods.productContent}"></span></p>-->
											<img th:src="${findGoods.productContent}" src="images/uploads/movie-single.jpg" alt="" style="max-width: 200%">
											<div class="title-hd-sm">
											</div>
										</div>
									</div>
								</div>
								<!--상세설명 [마지막]-->

								<!--댓글보기 전체[시작]-->
								<div id="reviews" class="tab review" style="margin-bottom: 10px;">
									<!--<h3>공연제목 : <span th:text="${findTicket.productName}"></span></h3>
									<h4>아티스트 : <span th:text="${findTicket.productArtist}"></span></h3>-->
									
									<!--댓글보기 내용[시작]-->
									<div class="tab active" style="margin-top: 40px; margin-bottom: 50px;">
										
										<div style="margin-bottom:10px;"></div>
										<!--정렬탭[시작]-->
										<div class="comments" style="margin-bottom: 50px;">
											<h4 th:text="| 총 ${ReplyList.size()} 개의 댓글|" style="color: white;">
												Comments</h4>
										
																				<!--<div class="topbar-filter">
																					<p>총 <span th:text="${ReplyList.size()} + ' 개의 댓글'"
																							style="color: white; border-bottom: 1px solid #233a50;"></span>
																					</p>
																					<select>
																						<option value="popularity">최신순</option>
																						<option value="popularity">오래된순</option>
																					</select>
																				</div>-->
										
											<!--정렬탭[마지막]-->
										
											<div style="margin-top: 30px;">
												<div class="cmt-item flex-it" th:each="ReplyList : ${ReplyList}"
													style="background: #233a50; margin-top: 10px;border: 15px solid #233a50; border-radius: 10px;">
													<img src="images/icons8-account-48.png" alt="">
													<div class="author-infor">
														<div class="flex-it2">
															<!--Name으로 체인지 가능-userinfo-->
															<h6 th:text="${ReplyList.getUser.getUserName}" style="color: white; font-size: 20px;">
																Name
															</h6>
															<span class="time" th:text="|[${ReplyList.getUser.getUserId}]|"> userId </span>
															<span class="time" th:text="${#temporals.format(ReplyList.CreDateTime,'yyyy-MM-dd HH:mm')}"> 27 Mar
																2017</span>
														</div>
														<p th:text="${ReplyList.ProductReplyContent}" style="color: white;"> content </p>
													</div>
										
												</div>
											</div>
										</div>
								
										<!--리스트 나열 [마지막]-->

										<!--댓글작성하기 폼	[시작]-->
										<div class="comment-form" style="color: white; 
												margin-top:30px; margin-bottom: 30px; background-color: #233a50; border: 15px solid #233a50; border-radius: 5px">
											<h4 style="margin-top:15px; margin-bottom: 15px; background-color: #233a50;">댓글쓰기</h4>
											<div style="margin-bottom:20px; border-bottom:10px double #8ab1b5;"></div>
											<form action="">
												<div class="row">
													<div class="col-md-4">
														<input type="text" placeholder="작성자 이름" id="comment_id"
															style="font-size: 15px;" th:value="${userIdString}">
													</div>

												</div>
												<div class="row">
													<div class="col-md-12">
														<textarea name="message" id="comment_content"
															placeholder="댓글을 입력하세요"
															style="margin-top: 5px; margin-bottom: 5px; height: 100px;"></textarea>
													</div>
												</div>
												<input class="submit" type="button" value="댓글달기"
													onclick="create_reply()"
													style="background-color : white; color: #5c5c5c;">
											</form>
										</div>

										<!--댓글작성하기 폼	[마지막]-->									
										<!--댓글란[마지막]-->
									</div>
									<!--댓글보기 내용[마지막]-->

								</div>
								<!--댓글보기 전체[마지막]-->
							</div>
							<!--탭 내용 [마지막]-->
						</div>
						<!--탭 [마지막]-->
					</div>
					<!--탭 전체 [마지막]-->					
					
					
				</div>
				<!--굿즈 정보표시[마지막]-->

		</div>
		</div>
		</div>
			<!--굿즈 정보전체[마지막]-->

		<div th:insert="~{common_footer :: footerFragment}"></div>

</body>
<script>

/* 	 function sendPostRequest() {
		 var cartIdElement = document.getElementById('cartId');
		 var cartId = cartIdElement.value;
		 var productNoElement = document.getElementById('productNo');
		 var productNo = productNoElement.value;
		// var productQtyElement = document.getElementById('qty');
		 //var productQty = productQtyElement.value;
		 
		const writeData = {
			//"productQty": productQty,
			"productNo": productNo,
			"cartId":cartId
		};
debugger;
		fetch('/2023-05-JAVA-DEVELOPER-final-project-team1-mango/cart_main/cart_create', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify(writeData),
		})
			.then(response => {
				if (response.ok) {
					return response.json();
				}
				throw new Error('장바구니 추가 실패');
			})
			.then(writeData => {
				alert('장바구니 추가 성공:', writeData);
				// 여기에 추가로 필요한 로직 작성 가능
			})
			.catch(error => {
				console.error('에러 발생:', error);
				alert('장바구니 추가 실패: ' + error.message); // 사용자에게도 실패 메시지를 보여줍니다.
				// 에러 처리 로직 작성 가능
			});


	}  */
	 
	  /*  $(document).ready(function () {
	        // "장바구니 담기" 버튼 클릭 시
		   alert("asdsadsadsa");
	        $(".sendPostRequest()").on("click", function () {
	            // 선택한 상품 정보 수집 (상품 번호, 수량 등)
	            var productId = $("#productNo").val(); // 상품 번호를 가져오는 예시
	            var quantity = $("#qty").val(); // 수량을 가져오는 예시

	            // 장바구니에 담을 상품 정보를 JSON 형식으로 생성
	            var cartItemData = {
	                productNo: productNo,
	                cartItemQty: qty
	                // 여기에 필요한 다른 상품 정보 추가 가능
	            };

	            // AJAX를 사용하여 서버에 장바구니에 상품 추가 요청
	            $.ajax({
	                type: "POST",
	                contentType: "application/json",
	                url: "/2023-05-JAVA-DEVELOPER-final-project-team1-mango/cart_main/cart_create",
	                data: JSON.stringify(cartItemData),
	                success: function (response) {
	                	
	                    console.log("장바구니에 상품이 성공적으로 추가되었습니다.", response);
	                    // 여기에 추가 성공 시 수행할 동작 추가 가능
	                },
	                error: function (error) {
	                    console.error("장바구니에 상품 추가 중 오류가 발생했습니다.", error);
	                    // 여기에 오류 발생 시 수행할 동작 추가 가능
	                }
	            });
	        });
<<<<<<< HEAD
	    }); */

//
	function changeQuantity(amount) {
		var quantityInput = document.getElementById('quantity');
		var currentValue = parseInt(quantityInput.value);

		// Ensure that the quantity does not go below 1
		if (currentValue + amount >= 1) {
			quantityInput.value = currentValue + amount;
			
			// 변경된 수량 콘솔에 찍기
            console.log('수량:', quantityInput.value);
		}
	}

function sendPostRequest() {
	var userIdElement = document.getElementById('userId');
	var userId = userIdElement.value;
	var productNoElement = document.getElementById('productNo');
	var productNo = productNoElement.value;
	//var productQtyElement = document.getElementById('qty');
	var productQty = 1;

    var data = {
        productNo: productNo,
        userId: userId,
        productQty: productQty
    };

    // AJAX를 사용하여 POST 요청 보내기
    $.ajax({
        type: "POST",
        url: `/2023-05-JAVA-DEVELOPER-final-project-team1-mango/product/product_goods_Cart_detail/${productNo}/${userId}/${productQty}`,
        contentType: "application/json",
        data: JSON.stringify(data),
        success: function (response) {
            // 성공적으로 처리된 경우 실행할 코드
            alert("장바구니에 담겼습니다.");
            console.log(response);
             window.location.href ="/2023-05-JAVA-DEVELOPER-final-project-team1-mango/cart_main";
        },
        error: function (xhr, status, error) {
            // 오류가 발생한 경우 실행할 코드
            console.error(error);
        }
    });


}
	/*================댓글작성[시작]================*/
	function create_reply() {
		const urlParams = new URLSearchParams(window.location.search);
		const productNo = urlParams.get("productNo");
		console.log(productNo);

		var commentContent = $("#comment_content").val()
		console.log(commentContent);

		var commentId = $("#comment_id").val()
		console.log(commentId);

		const commentData = {
			"productReplytTitle": "댓글타이틀",
			"productReplyContent": commentContent,
			"productNo": productNo,
			"userId": commentId //세션처리 아이디넣으면 자동으로 이름들어옴
		}
		console.log(commentData);
		fetch(`/2023-05-JAVA-DEVELOPER-final-project-team1-mango/product_reply_create/${productNo}`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(commentData)
		})
			.then(response => {
				if (response.status === 201) {
					alert('댓글 등록되었습니다.');
					//	location.reload(); // 현재 페이지를 새로 고침
					window.location.href = "/2023-05-JAVA-DEVELOPER-final-project-team1-mango/product_goods_detail?productNo=" + productNo;
				} else {
					alert('댓글 등록에 실패했습니다.');
					alert('에러 발생: ' + error);

				}
			})
			.catch(error => {
				alert('에러 발생: ' + error);
			});
		/*================댓글작성[마지막]================*/

	}

</script>
<script src="js/jquery.js"></script>
<script src="js/plugins.js"></script>
<script src="js/plugins2.js"></script>
<script src="js/custom.js"></script>

</html>